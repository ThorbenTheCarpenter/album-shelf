{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.propagateErrors = propagateErrors;\nexports.settled = settled;\nexports.collectErrors = collectErrors;\nexports.default = runValidations;\n\nvar _objectWithoutPropertiesLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutPropertiesLoose\"));\n\nvar _synchronousPromise = require(\"synchronous-promise\");\n\nvar _ValidationError = _interopRequireDefault(require(\"../ValidationError\"));\n\nvar promise = function promise(sync) {\n  return sync ? _synchronousPromise.SynchronousPromise : Promise;\n};\n\nvar unwrapError = function unwrapError(errors) {\n  if (errors === void 0) {\n    errors = [];\n  }\n\n  return errors.inner && errors.inner.length ? errors.inner : [].concat(errors);\n};\n\nfunction scopeToValue(promises, value, sync) {\n  //console.log('scopeToValue', promises, value)\n  var p = promise(sync).all(promises); //console.log('scopeToValue B', p)\n\n  var b = p.catch(function (err) {\n    if (err.name === 'ValidationError') err.value = value;\n    throw err;\n  }); //console.log('scopeToValue c', b)\n\n  var c = b.then(function () {\n    return value;\n  }); //console.log('scopeToValue d', c)\n\n  return c;\n}\n/**\r\n * If not failing on the first error, catch the errors\r\n * and collect them in an array\r\n */\n\n\nfunction propagateErrors(endEarly, errors) {\n  return endEarly ? null : function (err) {\n    errors.push(err);\n    return err.value;\n  };\n}\n\nfunction settled(promises, sync) {\n  var Promise = promise(sync);\n  return Promise.all(promises.map(function (p) {\n    return Promise.resolve(p).then(function (value) {\n      return {\n        fulfilled: true,\n        value: value\n      };\n    }, function (value) {\n      return {\n        fulfilled: false,\n        value: value\n      };\n    });\n  }));\n}\n\nfunction collectErrors(_ref) {\n  var validations = _ref.validations,\n      value = _ref.value,\n      path = _ref.path,\n      sync = _ref.sync,\n      errors = _ref.errors,\n      sort = _ref.sort;\n  errors = unwrapError(errors);\n  return settled(validations, sync).then(function (results) {\n    var nestedErrors = results.filter(function (r) {\n      return !r.fulfilled;\n    }).reduce(function (arr, _ref2) {\n      var error = _ref2.value; // we are only collecting validation errors\n\n      if (!_ValidationError.default.isError(error)) {\n        throw error;\n      }\n\n      return arr.concat(error);\n    }, []);\n    if (sort) nestedErrors.sort(sort); //show parent errors after the nested ones: name.first, name\n\n    errors = nestedErrors.concat(errors);\n    if (errors.length) throw new _ValidationError.default(errors, value, path);\n    return value;\n  });\n}\n\nfunction runValidations(_ref3) {\n  var endEarly = _ref3.endEarly,\n      options = (0, _objectWithoutPropertiesLoose2.default)(_ref3, [\"endEarly\"]);\n  if (endEarly) return scopeToValue(options.validations, options.value, options.sync);\n  return collectErrors(options);\n}","map":{"version":3,"sources":["C:/Users/jolej/Documents/GitHub/album-shelf/client/node_modules/yup/lib/util/runValidations.js"],"names":["_interopRequireDefault","require","exports","__esModule","propagateErrors","settled","collectErrors","default","runValidations","_objectWithoutPropertiesLoose2","_synchronousPromise","_ValidationError","promise","sync","SynchronousPromise","Promise","unwrapError","errors","inner","length","concat","scopeToValue","promises","value","p","all","b","catch","err","name","c","then","endEarly","push","map","resolve","fulfilled","_ref","validations","path","sort","results","nestedErrors","filter","r","reduce","arr","_ref2","error","isError","_ref3","options"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\r\n\r\nexports.__esModule = true;\r\nexports.propagateErrors = propagateErrors;\r\nexports.settled = settled;\r\nexports.collectErrors = collectErrors;\r\nexports.default = runValidations;\r\n\r\nvar _objectWithoutPropertiesLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutPropertiesLoose\"));\r\n\r\nvar _synchronousPromise = require(\"synchronous-promise\");\r\n\r\nvar _ValidationError = _interopRequireDefault(require(\"../ValidationError\"));\r\n\r\nvar promise = function promise(sync) {\r\n  return sync ? _synchronousPromise.SynchronousPromise : Promise;\r\n};\r\n\r\nvar unwrapError = function unwrapError(errors) {\r\n  if (errors === void 0) {\r\n    errors = [];\r\n  }\r\n\r\n  return errors.inner && errors.inner.length ? errors.inner : [].concat(errors);\r\n};\r\n\r\nfunction scopeToValue(promises, value, sync) {\r\n  //console.log('scopeToValue', promises, value)\r\n  var p = promise(sync).all(promises); //console.log('scopeToValue B', p)\r\n\r\n  var b = p.catch(function (err) {\r\n    if (err.name === 'ValidationError') err.value = value;\r\n    throw err;\r\n  }); //console.log('scopeToValue c', b)\r\n\r\n  var c = b.then(function () {\r\n    return value;\r\n  }); //console.log('scopeToValue d', c)\r\n\r\n  return c;\r\n}\r\n/**\r\n * If not failing on the first error, catch the errors\r\n * and collect them in an array\r\n */\r\n\r\n\r\nfunction propagateErrors(endEarly, errors) {\r\n  return endEarly ? null : function (err) {\r\n    errors.push(err);\r\n    return err.value;\r\n  };\r\n}\r\n\r\nfunction settled(promises, sync) {\r\n  var Promise = promise(sync);\r\n  return Promise.all(promises.map(function (p) {\r\n    return Promise.resolve(p).then(function (value) {\r\n      return {\r\n        fulfilled: true,\r\n        value: value\r\n      };\r\n    }, function (value) {\r\n      return {\r\n        fulfilled: false,\r\n        value: value\r\n      };\r\n    });\r\n  }));\r\n}\r\n\r\nfunction collectErrors(_ref) {\r\n  var validations = _ref.validations,\r\n      value = _ref.value,\r\n      path = _ref.path,\r\n      sync = _ref.sync,\r\n      errors = _ref.errors,\r\n      sort = _ref.sort;\r\n  errors = unwrapError(errors);\r\n  return settled(validations, sync).then(function (results) {\r\n    var nestedErrors = results.filter(function (r) {\r\n      return !r.fulfilled;\r\n    }).reduce(function (arr, _ref2) {\r\n      var error = _ref2.value;\r\n\r\n      // we are only collecting validation errors\r\n      if (!_ValidationError.default.isError(error)) {\r\n        throw error;\r\n      }\r\n\r\n      return arr.concat(error);\r\n    }, []);\r\n    if (sort) nestedErrors.sort(sort); //show parent errors after the nested ones: name.first, name\r\n\r\n    errors = nestedErrors.concat(errors);\r\n    if (errors.length) throw new _ValidationError.default(errors, value, path);\r\n    return value;\r\n  });\r\n}\r\n\r\nfunction runValidations(_ref3) {\r\n  var endEarly = _ref3.endEarly,\r\n      options = (0, _objectWithoutPropertiesLoose2.default)(_ref3, [\"endEarly\"]);\r\n  if (endEarly) return scopeToValue(options.validations, options.value, options.sync);\r\n  return collectErrors(options);\r\n}"]},"metadata":{},"sourceType":"script"}